---
import DocsLayout from '../../../layouts/DocsLayout.astro'
import { findDoc, getAllDocs } from '../../../lib/docs'
import { notFound } from 'astro:assets'
export async function getStaticPaths() {
  ---
  import DocsLayout from '../../../layouts/DocsLayout.astro'
---

  export async function getStaticPaths() {
    const pages = getAllDocs()
    return pages.map((p) => ({ params: { version: p.version, category: p.category } }))
  }

  const { version, category } = Astro.params

  const page = findDoc(version, category)

  if (!page) throw new Error('Doc not found')

  const all = getAllDocs()
  const sidebar = all
    .filter((p) => p.version === page.version)
    .sort((a, b) => (a.title || a.category).localeCompare(b.title || b.category))
  ---

  <DocsLayout title={page.title}>
    <div slot="sidebar">
      <div class="text-sm font-medium">Versi: {page.version}</div>
      <ul class="mt-2 space-y-1">
        {sidebar.map((s) => (
          <li>
            <a href={`/docs/${s.version}/${s.category}`} class="text-sm hover:underline">{s.title}</a>
          </li>
        ))}
      </ul>
    </div>

    <article>
      <h1>{page.title}</h1>
      <div set:html={page.module.html} />
    </article>
  </DocsLayout>
